<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>B210 相干干涉教学演示</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 800px; }
        canvas { background: #000; border-radius: 8px; width: 100%; height: 300px; }
        .controls { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .slider-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; color: #333; }
        .status { margin-top: 15px; padding: 10px; border-radius: 6px; text-align: center; font-weight: bold; }
        .status.constructive { background: #e6fffa; color: #38b2ac; }
        .status.destructive { background: #fff5f5; color: #e53e3e; }
        .value-display { font-family: monospace; color: #2b6cb0; }
        button { padding: 10px; cursor: pointer; border-radius: 5px; border: none; background: #4299e1; color: white; font-weight: bold; }
        button.active { background: #f56565; }
    </style>
</head>
<body>

<div class="card">
    <h2>无线电相干干涉模拟 (B210 实验)</h2>
    <p>演示点：调节相位偏移达到 180° 实现信号完全相消</p>
    
    <canvas id="waveCanvas"></canvas>

    <div class="controls">
        <div class="slider-group">
            <label>TX2 相位偏移 (Phase Shift): <span id="phaseVal" class="value-display">0</span>°</label>
            <input type="range" id="phaseSlider" min="0" max="360" value="0">
        </div>
        <div class="slider-group">
            <label>自动化控制</label>
            <button id="scanBtn">开启 360° 自动扫描</button>
        </div>
    </div>

    <div id="statusBox" class="status constructive">
        当前状态：相长干涉 (信号增强)
    </div>

    <div style="margin-top:20px; font-size: 0.9em; color: #666;">
        <strong>干货提示：</strong><br>
        • 黄色线/蓝色线：TX1 和 TX2 的原始正弦波。<br>
        • 白色粗线：接收端合成后的信号功率。注意观察相位 180° 时的“静默点”。
    </div>
</div>

<script>
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    const phaseSlider = document.getElementById('phaseSlider');
    const phaseVal = document.getElementById('phaseVal');
    const scanBtn = document.getElementById('scanBtn');
    const statusBox = document.getElementById('statusBox');

    let phaseShift = 0;
    let time = 0;
    let isScanning = false;

    // 画布尺寸初始化
    function resize() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }
    window.onresize = resize;
    resize();

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const centerY = canvas.height / 2;
        const amplitude = 60;
        const freq = 0.05;
        const radShift = (phaseShift * Math.PI) / 180;

        // 1. 绘制 TX1 波形 (固定) - 黄色
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(255, 255, 0, 0.4)';
        for (let x = 0; x < canvas.width; x++) {
            const y = centerY + amplitude * Math.sin(x * freq + time);
            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // 2. 绘制 TX2 波形 (带偏移) - 蓝色
        ctx.beginPath();
        ctx.strokeStyle = 'rgba(0, 255, 255, 0.4)';
        for (let x = 0; x < canvas.width; x++) {
            const y = centerY + amplitude * Math.sin(x * freq + time + radShift);
            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
        }
        ctx.stroke();

        // 3. 绘制合成波形 (Y = S1 + S2) - 白色粗线
        ctx.beginPath();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 3;
        let maxAmp = 0;
        for (let x = 0; x < canvas.width; x++) {
            const s1 = amplitude * Math.sin(x * freq + time);
            const s2 = amplitude * Math.sin(x * freq + time + radShift);
            const y = centerY + (s1 + s2);
            if (x === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
            maxAmp = Math.max(maxAmp, Math.abs(s1 + s2));
        }
        ctx.stroke();
        ctx.lineWidth = 1;

        // 更新状态文字
        if (maxAmp < amplitude * 0.3) {
            statusBox.innerText = "当前状态：相消干涉 (Destructive - 信号抵消)";
            statusBox.className = "status destructive";
        } else if (maxAmp > amplitude * 1.7) {
            statusBox.innerText = "当前状态：相长干涉 (Constructive - 信号增强)";
            statusBox.className = "status constructive";
        } else {
            statusBox.innerText = "当前状态：过渡阶段";
            statusBox.className = "status";
        }

        // 自动扫描逻辑
        if (isScanning) {
            phaseShift = (phaseShift + 1) % 360;
            phaseSlider.value = phaseShift;
            phaseVal.innerText = phaseShift;
        }

        time -= 0.15; // 波纹流动速度
        requestAnimationFrame(draw);
    }

    phaseSlider.oninput = () => {
        if(isScanning) toggleScan();
        phaseShift = parseInt(phaseSlider.value);
        phaseVal.innerText = phaseShift;
    };

    function toggleScan() {
        isScanning = !isScanning;
        scanBtn.innerText = isScanning ? "停止扫描" : "开启 360° 自动扫描";
        scanBtn.className = isScanning ? "active" : "";
    }

    scanBtn.onclick = toggleScan;

    draw();
</script>
</body>
</html>
